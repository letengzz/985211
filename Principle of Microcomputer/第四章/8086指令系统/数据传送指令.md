# 数据传送指令

​	数据传送类指令实现CPU内部寄存器之间、CPU与存储器之间、CPU与I/O端口之间的数据传送。

## 通用数据传送指令

包括 [MOV]()、[进栈、出栈指令]()、[交换指令]()和[换码指令]()。

### 一般数据传送指令

**格式**：

​	`MOV	OP目,OP源`

**功能**：OP源 ----> OP目 
**要求**：OP目 可以是[寄存器]()(除`CS`外)、[存储器]()
            OP源可以是[寄存器]()、[存储器]()和[立即数]()

![image-20220519093915544](D:/Data/typora/photo/image-20220519093915544.png)

**注意**： 

- MOV指令的两个操作数（源、目的）均可采用不同的[寻址方式]()。
- 源操作数和目的操作数的类型必须一致(8位/16位)
- 不允许把立即数作目的操作数，也不允许向段寄存器送立即数。
- 不允许在段寄存器之间、存储器单元之间传送数据。
- `CS`、`IP`寄存器不能用作目的操作数。
            `MOV  CS，AX`          ╳ 
- 一般传送指令不影响标志位。

### 堆栈操作指令

堆栈：是按“**后进先出**”原则工作的一段存储器区域。

堆栈寄存器`SS`——段地址
堆栈指针`SP`——始终当前栈顶所在的存储单元地址，即最新入栈数据所在的存储单元的地址。

**压栈操作**：

​	`PUSH	OP`

**功能**：把OP字数据压入栈中，结果SP-2-->SP
**原则**：高字节压在高地址，低字节压在低地址   
**执行过程**：   SP←SP-1；    [SP] ←OPH
                       SP←SP-1 ；   [SP] ←OPL

**出栈操作**：      

​	`POP	OP`

**功能**：从栈中弹出数据-->OP，结果SP+2-->SP
​**执行过程**：  OPL ←[SP]；      SP←SP+1 
​                           OPH←[SP] ；      SP←SP+1

**注意**： 

- 堆栈操作总是按字进行的。

- 压入指令，SP-2，数据在栈顶。弹出指令正好相反。

- 操作数可以是存储器、寄存器或段寄存器操作数(CS不能用于POP)，不能是立即数。

  ​    `PUSH CS`  √      `POP CS` ×

  ​    `PUSH 1200H` ×   `POP 2300H` ×

- 这两条指令主要**用来进行现场保护和恢复**，以保证子程序调用或中断程序的正常返回。 

### 数据交换指令

**格式**： 

​	`XCHG  OP1，OP2`

**功能**：实现OP1和OP2内容的相互交换。

**操作数**：通用寄存器或存储器，但不能均为内存单元。

**注意**： **段寄存器和`IP`不能作为交换指令的操作数**。

### 换码指令

​	换码指令(查表指令、翻译指令)是一条完成字节翻译功能的指令。它可以使累加器中的一个值变换为内存表格中的某一个值，一般用来实现编码制的转换。

**格式**： 

​	`XLAT`

**功能**：[BX+AL] -->AL

**说明**：将BX和AL内容相加作为有效地址`EA`，在一个表格中找出此单元中的内容-->AL中。

- BX——表格的首地址

- AL——相对于表格首地址的位移量(要转换的代码)

![image-20220519153817947](D:/Data/typora/photo/image-20220519153817947.png)

**注意**： 

1. 使用前，先建立被转换代码（字节型）的数据表。

2. 换码指令只能使用寄存器BX、AL，**不影响标志位**。

## 目标地址传送指令

​	此类指令的功能是将操作数所在存储器的地址送入目标寄存器。

**注意**：  

1. OP源必须是存储器操作数，

​	   OP目必须是16位的通用寄存器 。

2. 地址传送指令不影响状态标志位。

### 取有效地址EA指令

**格式**：

​	`LEA OP目, OP源`
**功能**：将源操作数的有效地址EA送到目的操作数。

**例**： 

​	`LEA  AX，[5678H]`	`;AX ← 5678H`
​	`LEA BX，[BP+SI]`	`;BX ←BP+SI`

### 指针送寄存器和`DS`指令

**格式**： 

​	`LDS  OP目，OP源`

**功能**：把OP源指定的4个字节内容取出，低地址的两字节-->OP目，高地址的两字节-->`DS`。

**例**：

​	`LDS DI，[2130H]`	`;2130H和2131H单元中的内容-->DI`

​										`;2132H和2133H单元中的内容-->DS`

![image-20220519155448824](D:/Data/typora/photo/image-20220519155448824.png)

### 指针送寄存器和`ES`指令

**格式**：

​	`LES  OP目，OP源`

**功能**：本指令与`LDS`指令的操作基本相同，所不同的是将OP源4个字节中高地址的两字节-->ES。

**例**：

​	`LES DI，[2130H]`	`;2130H和2131H单元中的内容-->DI`

​								   `;2132H和2133H单元中的内容-->ES`

![image-20220519155803114](D:/Data/typora/photo/image-20220519155803114.png)

## 标志寄存器传送指令

### 读取标志指令

**格式**：

​	`LAHF`	`;AH←标志寄存器低8位`

**特点**： 此指令操作结果不影响标志寄存器。

### 设置标志指令

**格式**：

​	`SAHF`	`;标志寄存器低8位←AH`

**特点**： 此指令直接为标志寄存器的低8位赋值。

![image-20220519222210039](D:/Data/typora/photo/image-20220519222210039.png)

### 对标志寄存器的堆栈操作指令

 **格式**：

​	`PUSHF`	`;将标志寄存器的值压栈。`

​	`POPF`	`;从栈顶弹出一个字送标志寄存器。`

**特点**: 

1. `PUSHF`不影响标志寄存器，而`POPF`直接为标志寄存器赋值。

     2. 通常两指令成对出现，用来保护和恢复标志寄存器的内容。 
