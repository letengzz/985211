# 段地址寄存器 (在`BIU`)16位

   编程时，程序和各种不同类型的数据分别存放在不同的逻辑段中，它们的"**段基址**"存放在"**段寄存器**"中，段内的**偏移地址**存放在**指针寄存器或变址寄存器中**。   

**逻辑地址的形式**：`段地址:偏移地址(有效地址EA)`

## 段寄存器

​	计算机需要对内存分段，以分配给不同的程序使用，**每一个段就有一个段基址**，而段寄存器保存的就是这个段基址的高16位。
​	段寄存器是CPU对内存进行分段管理而设置的，当一个程序要执行时，就要决定程序代码、数据或堆栈各要用到内存的哪些位置，通过设定段寄存器指向内存对应段的起始位置。

## 段基址

​	段基址表示一个段的起始地址的**高16位**。偏移地址表示段内的一个单元距离段开始位置的距离，因此，偏移地址也称为**段内地址**。 例如：`2345H:1100H`表示段基址为`2345H`(段的起始地址是`23450H`)，**段内偏移地址**为`1100H`的存储单元地址。

​	**偏移地址无论怎么偏移，都不会出段地址的范围**。

![image-20220102175223557](https://cdn.jsdelivr.net/gh/letengzz/Two-C/img/PM/Second/image-20220102175223557.png)


## 存储器的分段

​    8086可寻址的存储空间为`1MB`，有20位的**地址线**(物理地址为20位)，而内部的寄存器是16位，只能寻址`64KB`。所以`8086/8088`系统采用了**地址分段**的方法，将`1M`存储空间分成若干块，称为"**逻辑段**"，每个逻辑段容量`≤64KB`，存放一种类型的数据或者程序。因此`1M`的存储空间**可分成16个逻辑段(0～15)**(没有重叠为16个逻辑段)。在**段内寻址仍采用传统的16位地址寻址方法**。

​	**段地址处于20位地址线的高16位，偏移地址处于20位地址线的低16位；所重叠的12位相加得到物理地址**。

![image-20220405214144857](https://cdn.jsdelivr.net/gh/letengzz/Two-C@main/img/PM/Second/%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80.png)

**公式**：

> 物理地址 = 段地址(段基地址) × 16 + 偏移地址
>
> 物理地址 = 段首地址 + 相对于段首的偏移量

逻辑地址`2345H:1100H`对应的物理地址是`24550H`。
       `23450H+1100H =24550H`。
    反之，物理地址`24550H`，它对应的逻辑地址可以是`2455H:0000H`，也可以是`2400H:0550H`等。

**注意**：**一个存储单元的物理地址是唯一的，而它对应的逻辑地址是不唯一的**。

​	在8086存储空间中，把16字节的存储空间称作**一节**(`paragraph`)。要求各个逻辑段从节的整数边界开始，即**段首地址低4位应该是"0"，把段首地址的高16位称为"段基址"**，存放在段寄存器`DS`或`CS`或`SS`或`ES`中。

![image-20220406155923594](https://cdn.jsdelivr.net/gh/letengzz/Two-C@main/img/PM/Second/%E5%AD%98%E5%82%A8%E5%99%A81.png)

<img src="https://cdn.jsdelivr.net/gh/letengzz/Two-C/img/PM/Second/image-20211231211326086.png" alt="image-20211231211326086" style="zoom:67%;" />

​     允许段在整个存储空间浮动，即段与段之间可以**部分重叠**、**完全重叠**、**连续排列**。在整个存储空间中可设置若干个逻辑段。
​     对于任何一个物理地址，**可以唯一地被包含在一个逻辑段中，也可包含在多个相互重叠的逻辑段中**，只要有段地址和段内偏移地址就可以访问到这个物理地址所对应的存储空间

![image-20220507121737961](https://cdn.jsdelivr.net/gh/letengzz/Two-C@main/img/PM/Second/202205260932347.png)

​	段可分为**代码段**，**数据段**，**附加段**，**堆栈段**。用于存放段基址有4个**16位段寄存器**，代码段寄存器`CS`，数据段寄存器`DS`，附加段寄存器`ES`和堆栈段寄存器`SS`。


## 代码段寄存器`CS`

​	**代码段**：存放**程序代码**，程序代码超过`64K`时，需要分成几个段存放。`CS`中存放的是现在正在执行的程序段的段基址。

​	**`CS`专门用于保存指令** **代码块的指令除`CS`以外保存的数据信息 (`DS` `SS` `ES`)** ,**CS自动装入，其他则不会**。

## 数据段寄存器`DS`

​	**数据段**：内存用于存放当前使用的数据。需要第二个数据段时可以使用附加段。

## 附加段寄存器`ES`

​	用于存放当前使用的数据。需要第二个数据段时可以使用附加段。**附加段 是数据段的附属段**。

## 堆栈段寄存器`SS`

​	**堆栈段**：是内存中的一块**存储区**，用来**存放专用数据**。如调用**子程序**时的**入口参数**，**返回地址**等，这些数据都按照"**后进先出**"的规则进行存取。`SS`存放堆栈段的段基址，`SP`存放当前堆栈栈顶的偏移地址。数据进出堆栈要使用专门的堆栈操作指令，`SP`的值在执行堆栈操作指令时根据规则**自动地进行修改**(可以手动或自动)。

## 注意

1. 编程时，程序和各种不同类型的数据分别存放在不同的逻辑段中，它们的“段基址”存放在“段寄存器”中，段内的偏移地址存放在指针寄存器或变址寄存器中。  
2. `DS`、`SS`、`ES`表示对应有效的地址 对应**数据**的有效地址
2. `CS`对应指令的指针 中间的冒号代表逻辑对应关系 代表逻辑地址(`CS:IP`)

## 段寄存器和偏移(指针)固定搭配

![image-20220425143233689](https://cdn.jsdelivr.net/gh/letengzz/Two-C@main/img/PM/Second/%E6%AE%B5%E5%9B%BA%E5%AE%9A%E6%90%AD%E9%85%8D.png)

<img src="https://cdn.jsdelivr.net/gh/letengzz/Two-C@main/img/PM/Second/202205260938595.png" alt="image-20220507122031615" style="zoom:67%;" />

​	使用时`IP`与`CS`配合使用，可跟踪程序的执行过程;`SP`与`SS`配合使用，可指向目前的堆栈栈顶的位置。`BP`可用作`SS`的一个相对基址位置;`SI`用来存放相对于`DS`段的源变址指针;`DI`用来存放相对于`ES`段的目的变址指针。
